#! /bin/csh
# *Cassiopee* machine specific (local) variables

# Preliminary checks
if ($?CASSIOPEE == 0) then
    echo "You must specify a CASSIOPEE variablE in your environment."
    echo "This variable specifies the installation path of *Cassiopee*."
    exit
endif

# Environement
limit stacksize unlimited

# Compilation on different machines:

# Detection machine (shortest first)
set KC=`uname -n`
set MAC0=`echo $KC | grep 'n'`; if ($%MAC0 != 0) set MAC="sator"
set MAC0=`echo $KC | grep 'ld'`; if ($%MAC0 != 0) set MAC="ld"
set MAC0=`echo $KC | grep 'eos'`; if ($%MAC0 != 0) set MAC="eos"
set MAC0=`echo $KC | grep 'ubuntu'`; if ($%MAC0 != 0) set MAC="ubuntu"
set MAC0=`echo $KC | grep 'fulvio'`; if ($%MAC0 != 0) set MAC="fulvio"
set MAC0=`echo $KC | grep 'daapuv'`; if ($%MAC0 != 0) set MAC="daapuv"
set MAC0=`echo $KC | grep 'visio'`; if ($%MAC0 != 0) set MAC="visio"
set MAC0=`echo $KC | grep 'tiamat'`; if ($%MAC0 != 0) set MAC="tiamat"
set MAC0=`echo $KC | grep 'austri'`; if ($%MAC0 != 0) set MAC="austri"
set MAC0=`echo $KC | grep 'laura'`; if ($%MAC0 != 0) set MAC="laura"
set MAC0=`echo $KC | grep 'celeste'`; if ($%MAC0 != 0) set MAC="visio"
set MAC0=`echo $KC | grep 'elmer'`; if ($%MAC0 != 0) set MAC="visio"
set MAC0=`echo $KC | grep 'dumbo'`; if ($%MAC0 != 0) set MAC="visio"
set MAC0=`echo $KC | grep 'ganesh'`; if ($%MAC0 != 0) set MAC="visio"
set MAC0=`echo $KC | grep 'linux64'`; if ($%MAC0 != 0) set MAC="linux64"
set MAC0=`echo $KC | grep 'moloch'`; if ($%MAC0 != 0) set MAC="moloch"
set MAC0=`echo $KC | grep 'giulia'`; if ($%MAC0 != 0) set MAC="giulia"
set MAC0=`echo $KC | grep 'westri'`; if ($%MAC0 != 0) set MAC="westri"
set MAC0=`echo $KC | grep 'sator'`; if ($%MAC0 != 0) set MAC="sator"
set MAC0=`echo $KC | grep 'xdaap'`; if ($%MAC0 != 0) set MAC="xdaap"
set MAC0=`echo $KC | grep 'spiro'`; if ($%MAC0 != 0) set MAC="spiro"
set MAC0=`echo $KC | grep 'mangrove'`; if ($%MAC0 != 0) set MAC="mangrove"
set MAC0=`echo $KC | grep 'ldmfn423z'`; if ($%MAC0 != 0) set MAC="ld"
set MAC0=`echo $KC | grep 'node6.cluster'`; if ($%MAC0 != 0) set MAC="macosx"

# force: sator_sky, ld_pgi en faisant setenv MACHINE sator_sky
if ($?MACHINE != 0) then
    set MAC=$MACHINE
endif

unset KC

# ----------------------------- Common ----------------------------------------
#setenv ELSADIST $CASSIOPEE  # production (cfg)
#setenv ELSAPATH $CASSIOPEE  # production (cfg)
#setenv ELSAWKSP $CASSIOPEE  # production (cfg)

# Si la variable ELSA est dans l'environnement, on cree des chemins compatibles
# avec la version public : par ex: ELSA=/home/elsa/Public/v3.6.02 [eos only]

if ($MAC == "ld_pgi") then
#------------------------------- ld+PGI ---------------------------------------
        setenv ELSAPROD pgi_r8
        foreach x (`(echo "" ; module -t list) | & grep intel`)
            module unload $x
        end
        module load python/2.7.8
        module load hdf5/1.8.8
        set path=($path /d/juvigny/Logiciels/linux86-64/2018/bin)
        # Nombre de threads
        setenv OMP_NUM_THREADS 8
        set path=($CASSIOPEE/Dist/bin $path)
        set path=($CASSIOPEE/Dist/bin/$ELSAPROD $CASSIOPEE/Dist/bin/$ELSAPROD/bin $path)
        setenv LD_LIBRARY_PATHL /usr/lib64:/home/benoit/lib:$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/pgi_r8/lib:/usr/lib64/openmpi/lib:/d/juvigny/Logiciels/linux86-64/2018/lib
        setenv PYTHONPATHL $CASSIOPEE/Dist/lib/py:$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/pgi_r8:$CASSIOPEE/Dist/bin/pgi_r8/lib/python2.7/site-packages

else if ($MAC == "ld_python3") then
#-------------------------- ld centos 7 + python 3 -----------------------------
        setenv ELSAPROD py3_r8
        # Modules
        foreach x (`(echo "" ; module -t list) | & grep intel`)
            module unload $x
        end
        module load python/3.6.1
        module load intel/17.0.4
        module load impi/17
        module load hdf5/1.8.8-intel-15
        # Number of threads
        set ncpu=`cat /proc/cpuinfo |grep processor |cut -f2 -d: |tail -1`
        @ ncpu++
        setenv OMP_NUM_THREADS $ncpu
        set path=($path $CASSIOPEE/Dist/bin)
        set path=($CASSIOPEE/Dist/bin/$ELSAPROD $CASSIOPEE/Dist/bin/$ELSAPROD/bin $path)
        setenv LD_LIBRARY_PATHL /usr/lib64:/home/benoit/lib:$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/"$ELSAPROD"/lib
        setenv PYTHONPATHL $CASSIOPEE/Dist/lib/py:$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/"ELSAPROD"/lib/python3.6/site-packages
        
else if ($MAC == "ld") then
#----------------------------- ld centos 7 -------------------------------------
        setenv ELSAPROD x86_r8
        # Modules
        foreach x (`(echo "" ; module -t list) | & grep intel`)
            module unload $x
        end
        module load python/2.7.8
        module load intel/17.0.4
        module load impi/17
        module load hdf5/1.8.8-intel-15
        # Number of threads
        set ncpu=`cat /proc/cpuinfo |grep processor |cut -f2 -d: |tail -1`
        @ ncpu++
        setenv OMP_NUM_THREADS $ncpu
        #setenv KMP_AFFINITY "verbose,granularity=fine,proclist=[0,1,2,3,4,5,6,7],explicit"
        # chemin de mpirun (forced)
        #set path=($path)
        # Chemin de go
        set path=($path $CASSIOPEE/Dist/bin)
        if ($?ELSA == 0) then # Cassiopee
            set path=($CASSIOPEE/Dist/bin/$ELSAPROD $CASSIOPEE/Dist/bin/$ELSAPROD/bin $path)
            setenv LD_LIBRARY_PATHL /usr/lib64:/home/benoit/lib:$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/"$ELSAPROD"/lib
            #setenv LD_LIBRARY_PATHL $CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/"$ELSAPROD"/lib
            setenv PYTHONPATHL $CASSIOPEE/Dist/lib/py:$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/"$ELSAPROD"/lib/python2.7/site-packages
        else # elsA public
            set path=($ELSA/Dist/bin/eos-intel $path)
            setenv LD_LIBRARY_PATHL /usr/lib64:/home/benoit/lib:$ELSA/Dist/bin/eos-intel:$ELSA/Dist/bin/eos-intel/lib:/usr/local/python/lib
            setenv PYTHONPATHL $CASSIOPEE/Dist/bin/x86_r8/lib/python2.7/site-packages:$ELSA/Dist/lib/py:$ELSA/Dist/bin/eos-intel
        endif
        # Pour utilisation MKL+numpy
        #setenv LD_PRELOAD /opt/tools/intel/studio/2017/mkl/lib/intel64/libmkl_avx2.so:/opt/tools/intel/studio/2017/mkl/lib/intel64/libmkl_def.so:/opt/tools/intel/studio/2017/mkl/lib/intel64/libmkl_core.so:/opt/tools/intel/studio/2017/mkl/lib/intel64/libmkl_intel_lp64.so:/opt/tools/intel/studio/2017/mkl/lib/intel64/libmkl_intel_thread.so:/opt/tools/intel/studio/2017/lib/intel64/libiomp5.so

else if ($MAC == "eos") then
#----------------------------- eos -------------------------------------
        setenv ELSAPROD x86_r8
        # Modules
        foreach x (`(echo "" ; module -t list) | & grep intel`)
            module unload $x
        end
        module load python/2.7.8
        module load intel/17.0.4
        module unload impi/17
        module load hdf5/1.8.8
        # Number of threads
        set ncpu=`cat /proc/cpuinfo |grep processor |cut -f2 -d: |tail -1`
        @ ncpu++
        setenv OMP_NUM_THREADS $ncpu
        #setenv KMP_AFFINITY "verbose,granularity=fine,proclist=[0,1,2,3,4,5,6,7],explicit"
        # chemin de mpirun (forced)
        set path=(/usr/lib64/openmpi/bin $path)
        set path=($path $CASSIOPEE/Dist/bin)
        if ($?ELSA == 0) then # Cassiopee Kernel
            set path=($CASSIOPEE/Dist/bin/$ELSAPROD $CASSIOPEE/Dist/bin/$ELSAPROD/bin $path)
            setenv LD_LIBRARY_PATHL /usr/lib64:/stck/benoit/lib:$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/x86_r8/lib:/usr/lib64/openmpi/lib
            setenv PYTHONPATHL $CASSIOPEE/Dist/lib/py:$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/x86_r8:$CASSIOPEE/Dist/bin/x86_r8/lib/python2.7/site-packages
        else # elsA public
            set path=($ELSA/Dist/bin/eos-intel $path)
            setenv LD_LIBRARY_PATHL /usr/lib64:/stck/benoit/lib:$ELSA/Dist/bin/eos-intel:$ELSA/Dist/bin/eos-intel/lib:/usr/local/python/lib
            setenv PYTHONPATHL $CASSIOPEE/Dist/bin/x86_r8/lib/python2.7/site-packages:$ELSA/Dist/lib/py:$ELSA/Dist/bin/eos-intel
        endif
        # Pour utilisation MKL+numpy
        #setenv LD_PRELOAD /opt/tools/intel/studio/2017/mkl/lib/intel64/libmkl_avx2.so:/opt/tools/intel/studio/2017/mkl/lib/intel64/libmkl_def.so:/opt/tools/intel/studio/2017/mkl/lib/intel64/libmkl_core.so:/opt/tools/intel/studio/2017/mkl/lib/intel64/libmkl_intel_lp64.so:/opt/tools/intel/studio/2017/mkl/lib/intel64/libmkl_intel_thread.so:/opt/tools/intel/studio/2017/lib/intel64/libiomp5.so

else if ($MAC == "macosx") then
#----------------------------- Mac OSX-----------------------------------------
        
    setenv ELSAPROD macosx_r8
	setenv OMP_NUM_THREADS 2
	set path=($path $CASSIOPEE/Dist/bin/macosx_r8)
        setenv LD_LIBRARY_PATHL $CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/"$ELSAPROD"/lib:/opt/intel/composer_xe_2015/lib
        unsetenv BUNDLE
        setenv MACOSX_DEPLOYMENT_TARGET 10.10
        setenv PYTHONPATHL $CASSIOPEE/Dist/lib/py:$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/"$ELSAPROD"/lib/python2.7/site-packages
	setenv DYLD_LIBRARY_PATH $LD_LIBRARY_PATHL

else if ($MAC == "sgi") then
#-------------------------------- SGI -----------------------------------------
        setenv ELSAPROD sgi_r8
        setenv LD_LIBRARY_PATHL /tools/py/tmp/local/lib/:$CASSIOPEE/Kernel/lib/$ELSAPROD

else if ($MAC == "mangrove") then
#------------------------------- mangrove --------------------------------------
        setenv ELSAPROD man_r8
        setenv OMP_NUM_THREADS 4
        set path=($path $CASSIOPEE/Dist/bin)
        set path=($CASSIOPEE/Dist/bin/$ELSAPROD $CASSIOPEE/Dist/bin/$ELSAPROD/bin $path)
        setenv LD_LIBRARY_PATHL /opt/intel/Compiler/11.0/083/lib:$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/man_r8/lib
        setenv PYTHONPATHL $CASSIOPEE/Dist/lib/py:$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/man_r8:$CASSIOPEE/Dist/bin/man_r8/lib/python2.6/site-packages

else if ($MAC == "ubuntu") then
#-------------------------------- ubuntu ------------------------------------
        setenv ELSAPROD ub_r8
        setenv OMP_NUM_THREADS 2
        # chemin de l'executable python
        set path=(/benoit/bin $path)
        set path=($CASSIOPEE/Dist/bin/$ELSAPROD $CASSIOPEE/Dist/bin/$ELSAPROD/bin $path)
        # Chemin de elsA.x
        set path=($path $CASSIOPEE/Dist/bin/$ELSAPROD)
        setenv LD_LIBRARY_PATHL $CASSIOPEE/Kernel/lib/"$ELSAPROD":$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/ub_r8/lib
        setenv PYTHONPATHL $CASSIOPEE/Dist/lib/py:$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/ub_r8:$CASSIOPEE/Dist/bin/ub_r8/lib/python2.5/site-packages

else if ($MAC == "fulvio") then
#------------------------------- fulvio ---------------------------------------
        setenv ELSAPROD flv_r8
	foreach x (`(echo "" ; module -t list) | & grep intel`)
            module unload $x
        end
        module load   intel/15.0.6
	#module load   impi/15
        # Nombre de threads
        setenv OMP_NUM_THREADS 8
        # Chemin de python
        set path=(/usr/local/python/bin $path)
        set path=($path $CASSIOPEE/Dist/bin)
        set path=($CASSIOPEE/Dist/bin/$ELSAPROD $CASSIOPEE/Dist/bin/$ELSAPROD/bin $path)
        setenv LD_LIBRARY_PATHL $CASSIOPEE/Kernel/lib/"$ELSAPROD":$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/flv_r8/lib:/usr/local/lib64:/usr/local/hdf5-intel-1.8.8/lib
        setenv PYTHONPATHL $CASSIOPEE/Dist/lib/py:$CASSIOPEE/Dist/bin/flv_r8:$CASSIOPEE/Dist/bin/flv_r8/lib/python2.7/site-packages

else if ($MAC == "daapuv") then
#------------------------------- daapuv --------------------------------------
        setenv ELSAPROD uv_r8
        setenv OMP_NUM_THREADS 4
        set path=($path $CASSIOPEE/Dist/bin)
        set path=($CASSIOPEE/Dist/bin/$ELSAPROD $CASSIOPEE/Dist/bin/$ELSAPROD/bin $path)
        setenv LD_LIBRARY_PATHL $CASSIOPEE/Kernel/lib/"$ELSAPROD":$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/uv_r8/lib:/usr/local/hdf5-1.8.7/lib
        setenv PYTHONPATHL $CASSIOPEE/Dist/lib/py:$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/uv_r8:$CASSIOPEE/Dist/bin/uv_r8/lib/python2.6/site-packages

else if ($MAC == "visio") then
#------------------------------- visio ---------------------------------------
        setenv ELSAPROD vis_r8
        foreach x (`(echo "" ; module -t list) | & grep intel`)
            module unload $x
        end
        module load intel/15.0.6
        #module load impi/15
        # Nombre de threads
        setenv OMP_NUM_THREADS 16
        #setenv KMP_AFFINITY "verbose,granularity=fine,proclist=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],explicit"
        # Chemin de python
        set path=(/usr/local/python/bin $path)
        set path=($path $CASSIOPEE/Dist/bin)
        set path=($CASSIOPEE/Dist/bin/$ELSAPROD $CASSIOPEE/Dist/bin/$ELSAPROD/bin $path)
        setenv LD_LIBRARY_PATHL $CASSIOPEE/Kernel/lib/"$ELSAPROD":$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/vis_r8/lib:/usr/local/hdf5-intel-1.8.8/lib:/usr/local/lib64:/usr/lib64
        setenv PYTHONPATHL $CASSIOPEE/Dist/lib/py:$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/vis_r8:$CASSIOPEE/Dist/bin/vis_r8/lib/python2.7/site-packages

else if ($MAC == "tiamat") then
#------------------------------- tiamat ---------------------------------------
        setenv ELSAPROD tia_r8
        # Nombre de threads
        setenv OMP_NUM_THREADS 12
        setenv KMP_AFFINITY "verbose,granularity=fine,proclist=[0,1,2,3,4,5,6,7,8,9,10,11],explicit"
        # modules
        foreach x (`(echo "" ; module -t list) | & grep intel`)
            module unload $x
        end
        module load intel/16.0.4
        set path=(/home/tools/local/tiamat/bin $path $CASSIOPEE/Dist/bin)
        set path=($CASSIOPEE/Dist/bin/$ELSAPROD $CASSIOPEE/Dist/bin/$ELSAPROD/bin $path)
        setenv LD_LIBRARY_PATHL /home/tools/local/tiamat/lib:$CASSIOPEE/Kernel/lib/"$ELSAPROD":$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/tia_r8/lib64:/home/benoit/x86_64t/lib
        setenv PYTHONPATHL /home/tools/local/tiamat/lib/python2.7:$CASSIOPEE/Dist/lib/py:$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/tia_r8:$CASSIOPEE/Dist/bin/tia_r8/lib64/python2.7/site-packages

else if ($MAC == "austri") then
#------------------------------- austri ---------------------------------------
        setenv ELSAPROD aus_r8
        # Nombre de threads
        setenv OMP_NUM_THREADS 24
        setenv KMP_AFFINITY "verbose,granularity=fine,proclist=[0,2,4,6,8,10,12,14,16,18,20,22,1,3,5,7,9,11,13,15,17,19,21,23],explicit"
        #setenv KMP_AFFINITY "verbose,granularity=fine,proclist=[0,2,4,6,8,10,12,14,16,18,20,22,1,3,5,7,9,11,13,15,17,19,21,23,24,26,28,30,32,34,36,38,40,42,44,46,25,27,29,31,33,35,37,39,41,43,45,47],explicit"
        #setenv KMP_AFFINITY "verbose,granularity=fine,proclist=[1,3,5,7,9,11,13,15,17,19,21,23,0,2,4,6,8,10,12,14,16,18,20,22,25,27,29,31,33,35,37,39,41,43,45,47,24,26,28,30,32,34,36,38,40,42,44,46],explicit"
        setenv PROC_NAME "HASWELL"
        # modules
        foreach x (`(echo "" ; module -t list) | & grep intel`)
            module unload $x
        end
        module load intel/17.0.4
        module load impi/17 # very bad install
        module unload impi/17
        #source /home/nalferez/intel/parallel_studio_xe_2018/psxevars.csh
        #module load gcc/5.2
        module load hdf5/1.8.8-intel-11
        set path=($path $CASSIOPEE/Dist/bin)
        set path=($CASSIOPEE/Dist/bin/$ELSAPROD $CASSIOPEE/Dist/bin/$ELSAPROD/bin $path)
        setenv LD_LIBRARY_PATHL /home/benoit/aus/lib:$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/aus_r8/lib
        setenv PYTHONPATHL $CASSIOPEE/Dist/lib/py:$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/aus_r8:$CASSIOPEE/Dist/bin/aus_r8/lib/python2.7/site-packages

else if ($MAC == "laura") then
#------------------------------- laura ----------------------------------------
        setenv ELSAPROD laura_r8
        # chargement des modules
        #source /usr/share/modules/init/csh
        module load python/2.7.3.icc-mpt
        module load hdf5/1.8.7
        module load intel-mkl-10/10.3.1
        module load intel-cce-12/12.0.1.107
        module load intel-fce-12/12.0.1.107
        module load mpt/2.02
        setenv OMP_NUM_THREADS 12
        set path=($path $CASSIOPEE/Dist/bin)
        set path=($CASSIOPEE/Dist/bin/$ELSAPROD $CASSIOPEE/Dist/bin/$ELSAPROD/bin $path)
        setenv LD_LIBRARY_PATHL $CASSIOPEE/Kernel/lib/"$ELSAPROD":$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/laura_r8/lib:/home/benoit/laura/lib:/usr/local/lib64:/opt/intel/composerxe-2011.1.107/compiler/lib/intel64
        setenv PYTHONPATHL $CASSIOPEE/Dist/lib/py:$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/laura_r8:$CASSIOPEE/Dist/bin/laura_r8/lib/python2.7/site-packages

else if ($MAC == "linux64") then
#------------------------------- linux64 ---------------------------------------
        setenv ELSAPROD linux64
        # Number of threads
        setenv OMP_NUM_THREADS 4
        # chemin de python
        set path=(/usr/local/python/bin $path)
        set path=($path $CASSIOPEE/Dist/bin)
        set path=($CASSIOPEE/Dist/bin/$ELSAPROD $CASSIOPEE/Dist/bin/$ELSAPROD/bin $path)
        setenv LD_LIBRARY_PATHL /home/benoit/lib:$CASSIOPEE/Kernel/lib/"$ELSAPROD":$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/linux64/lib:/usr/local/python/lib:/usr/lib64/openmpi/lib
        setenv PYTHONPATHL $CASSIOPEE/Dist/lib/py:$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/linux64:$CASSIOPEE/Dist/bin/linux64/lib/python2.7/site-packages

else if ($MAC == "moloch") then
#------------------------------- moloch ---------------------------------------
        setenv ELSAPROD mol_r8
        # modules
        module load python/2.6.4/11.mpt
        module load hdf5/1.8.8-intel-11
        # Nombre de threads
        setenv OMP_NUM_THREADS 12
        set path=(/usr/bin $path $CASSIOPEE/Dist/bin)
        set path=($CASSIOPEE/Dist/bin/$ELSAPROD $CASSIOPEE/Dist/bin/$ELSAPROD/bin $path)
        setenv LD_LIBRARY_PATHL $CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/mol_r8/lib64
        setenv PYTHONPATHL $CASSIOPEE/Dist/lib/py:$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/mol_r8:$CASSIOPEE/Dist/bin/mol_r8/lib64/python2.6/site-packages

else if ($MAC == "giulia") then
#------------------------------- giulia ---------------------------------------
        setenv ELSAPROD giu_r8
        # Nombre de threads
        set ncpu=`cat /proc/cpuinfo |grep processor |cut -f2 -d: |tail -1`
        @ ncpu++
        setenv OMP_NUM_THREADS $ncpu
        # modules
        foreach x (`(echo "" ; module -t list) | & grep intel`)
            module unload $x
        end
        #module load gcc/5.2
        module load intel/17.0.4
        module load python/2.7.8
        module unload hdf5/1.8.8
        module load hdf5/1.8.8-intel-16.impi
        module load impi/16
        set path=($path $CASSIOPEE/Dist/bin)
        set path=($CASSIOPEE/Dist/bin/$ELSAPROD $CASSIOPEE/Dist/bin/$ELSAPROD/bin $path)
        setenv LD_LIBRARY_PATHL /usr/lib64:$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/"$ELSAPROD"/lib
        setenv PYTHONPATHL $CASSIOPEE/Dist/lib/py:$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/"$ELSAPROD"/lib/python2.7/site-packages

else if ($MAC == "westri") then
#------------------------------- westri (KNL) ---------------------------------------
        setenv ELSAPROD wes_r8
        # Nombre de threads
        setenv OMP_NUM_THREADS 64
        setenv KMP_AFFINITY "verbose,granularity=fine,proclist=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63],explicit"
        setenv PROC_NAME "KNL"
        # modules
        foreach x (`(echo "" ; module -t list) | & grep intel`)
            module unload $x
        end
        module purge
        module load intel/18.0.0 impi/18
        module load hdf5/1.8.8-intel-16
        module load python/2.7.8
        set path=($path $CASSIOPEE/Dist/bin)
        set path=($CASSIOPEE/Dist/bin/$ELSAPROD $CASSIOPEE/Dist/bin/$ELSAPROD/bin $path)
        setenv LD_LIBRARY_PATHL $CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/"$ELSAPROD"/lib
        setenv PYTHONPATHL $CASSIOPEE/Dist/lib/py:$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/"$ELSAPROD"/lib/python2.7/site-packages

else if ($MAC == "eos") then
#-------------------------------- ld (centos6) -----------------------------------------
        ELSAPROD x86_r8
        # Modules
        foreach x (`(echo "" ; module -t list) | & grep intel`)
            module unload $x
        end
        module load intel/13.1.3
        module load impi/13
        module load hdf5/1.8.8
        # Number of threads
        set ncpu=`cat /proc/cpuinfo |grep processor |cut -f2 -d: |tail -1`
        @ ncpu++
        setenv OMP_NUM_THREADS $ncpu
        #setenv KMP_AFFINITY "verbose,granularity=fine,proclist=[0,1,2,3,4,5,6,7],explicit"
        # chemin de python
        set path=(/usr/local/python/bin $path)
        # chemin de mpirun (forced)
        set path=(/usr/lib64/openmpi/bin $path)
        set path=($path $CASSIOPEE/Dist/bin)
        if ($?ELSA == 0) then # Cassiopee Kernel
            set path=($CASSIOPEE/Dist/bin/$ELSAPROD $CASSIOPEE/Dist/bin/$ELSAPROD/bin $path)
            setenv LD_LIBRARY_PATHL /home/benoit/lib:$CASSIOPEE/Kernel/lib/"$ELSAPROD":$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/x86_r8/lib:/usr/local/python/lib:/usr/lib64/openmpi/lib
            setenv PYTHONPATHL $CASSIOPEE/Dist/lib/py:$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/x86_r8:$CASSIOPEE/Dist/bin/x86_r8/lib/python2.7/site-packages
        else # elsA public
            set path=($ELSA/Dist/bin/eos-intel $path)
            setenv LD_LIBRARY_PATHL /home/benoit/lib:$ELSA/Dist/bin/eos-intel:$ELSA/Dist/bin/eos-intel/lib:/usr/local/python/lib
            setenv PYTHONPATHL $CASSIOPEE/Dist/bin/x86_r8/lib/python2.7/site-packages:$ELSA/Dist/lib/py:$ELSA/Dist/bin/eos-intel
        endif

else if ($MAC == "xdaap") then
#------------------------------- xdaap --------------------------------------
        setenv ELSAPROD xdaap_r8
        # Modules
        foreach x (`(echo "" ; module -t list) | & grep intel`)
            module unload $x
        end
        #module load gcc/4.8.1
        module load intel/15.0.6
        # Number of threads
        setenv OMP_NUM_THREADS 16
        set path=($path $CASSIOPEE/Dist/bin)
        set path=($CASSIOPEE/Dist/bin/$ELSAPROD $CASSIOPEE/Dist/bin/$ELSAPROD/bin $path)
        setenv LD_LIBRARY_PATHL /usr/lib64/:$CASSIOPEE/Kernel/lib/"$ELSAPROD":$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/xdaap_r8/lib:/usr/local/hdf5-intel-1.8.8/lib:/usr/local/lib64
        setenv PYTHONPATHL $CASSIOPEE/Dist/lib/py:$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/"$ELSAPROD"/lib/python2.7/site-packages

else if ($MAC == "spiro") then
#------------------------------- spiro --------------------------------------
        setenv ELSAPROD spiro_r8
        module load CFD/4.0-intel-17.impi
        # Number of threads
        setenv OMP_NUM_THREADS 24
        set path=($path $CASSIOPEE/Dist/bin)
        set path=($CASSIOPEE/Dist/bin/$ELSAPROD $CASSIOPEE/Dist/bin/$ELSAPROD/bin $path)
        setenv LD_LIBRARY_PATHL /usr/lib64/:$CASSIOPEE/Kernel/lib/"$ELSAPROD":$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/"$ELSAPROD"/lib:/usr/local/hdf5-intel-1.8.8/lib:/usr/local/lib64
        setenv PYTHONPATHL $CASSIOPEE/Dist/lib/py:$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/"$ELSAPROD"/lib/python2.7/site-packages

else if ($MAC == "sator") then
#------------------------------- sator --------------------------------------
# En dernier a cause de 'n'
        setenv ELSAPROD sat_r8
        echo "ELSAPROD="$ELSAPROD
        echo "pour compiler sur skylake, setenv MACHINE sator_sky, puis sourcer env_Cassiopee_r8"

        module unload intel/11.1.073
        module load CFD/4.0-intel-17.impi
        #module load intel/17.0.4 impi/17 python/2.7.8-intel-17.impi

        # HDF para (deja dans le socle)
        # module load hdf5/1.8.17-intel-17.impi
        
        # Number of threads
        setenv OMP_NUM_THREADS 28
        set path=($path $CASSIOPEE/Dist/bin)
        set path=($CASSIOPEE/Dist/bin/$ELSAPROD $CASSIOPEE/Dist/bin/$ELSAPROD/bin $path)
        #setenv LD_LIBRARY_PATHL $CASSIOPEE/Kernel/lib/"$ELSAPROD":$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/stv_r8/lib:/tmp_user/stelvio/benoit/sator/lib
        setenv LD_LIBRARY_PATHL $CASSIOPEE/Kernel/lib/"$ELSAPROD":$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/"$ELSAPROD"/lib:
        setenv PYTHONPATHL $CASSIOPEE/Dist/lib/py:$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/"$ELSAPROD"/lib/python2.7/site-packages

else if ($MAC == "sator_sky") then
#------------------------------- sator skylake ------------------------------------
# En dernier a cause de 'n'
        setenv ELSAPROD sat_sky_r8
        module unload intel/11.1.073
        module load CFD/4.0-intel-17.impi
        #module load intel/17.0.4 impi/17 python/2.7.8-intel-17.impi

        # HDF para (deja dans le socle)
        # module load hdf5/1.8.17-intel-17.impi
        
        # Number of threads
        setenv OMP_NUM_THREADS 28
        set path=($path $CASSIOPEE/Dist/bin)
        set path=($CASSIOPEE/Dist/bin/$ELSAPROD $CASSIOPEE/Dist/bin/$ELSAPROD/bin $path)

        #setenv LD_LIBRARY_PATHL $CASSIOPEE/Kernel/lib/"$ELSAPROD":$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/stv_r8/lib:/tmp_user/stelvio/benoit/sator/lib
        setenv LD_LIBRARY_PATHL $CASSIOPEE/Kernel/lib/"$ELSAPROD":$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/"$ELSAPROD"/lib:
        setenv PYTHONPATHL $CASSIOPEE/Dist/lib/py:$CASSIOPEE/Dist/bin/"$ELSAPROD":$CASSIOPEE/Dist/bin/"$ELSAPROD"/lib/python2.7/site-packages
endif
#---------------------------Common---------------------------------------------
alias emake "make -f Makefile.$ELSAPROD"

set STE=$LD_LIBRARY_PATHL
set STES='*'$STE'*'
if ($?LD_LIBRARY_PATH == 0) then
    setenv LD_LIBRARY_PATH $STE
else
    switch ($LD_LIBRARY_PATH)
    case $STES:
#        echo '->var detected; not added'
        breaksw
    default:
#        echo $LD_LIBRARY_PATH, $STE 
        setenv LD_LIBRARY_PATH "$STE":"$LD_LIBRARY_PATH"
        breaksw
    endsw
endif
#echo $LD_LIBRARY_PATH

set STE=$PYTHONPATHL
set STES='*'$STE'*'
if ($?PYTHONPATH == 0) then
    setenv PYTHONPATH $STE
else
    switch ($PYTHONPATH)
    case $STES:
#        echo '->var detected; not added'
        breaksw
    default:
#        echo $PYTHONPATH, $STE 
        setenv PYTHONPATH "$STE":"$PYTHONPATH"
        breaksw
    endsw
endif
#echo $PYTHONPATH

#echo $ELSAPROD' environment set.'
